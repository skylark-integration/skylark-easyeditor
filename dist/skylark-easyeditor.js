/**
 * skylark-easyeditor - The skylark markdown editor widget
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-easyeditor/
 * @license MIT
 */
!function(t,e){var n=e.define,i=e.require,a="function"==typeof n&&n.amd,r=!a&&"undefined"!=typeof exports;if(!a&&!n){var o={};n=e.define=function(t,e,n){"function"==typeof n?(o[t]={factory:n,deps:e.map(function(e){return function(t,e){if("."!==t[0])return t;var n=e.split("/"),i=t.split("/");n.pop();for(var a=0;a<i.length;a++)"."!=i[a]&&(".."==i[a]?n.pop():n.push(i[a]));return n.join("/")}(e,t)}),resolved:!1,exports:null},i(t)):o[t]={factory:null,resolved:!0,exports:n}},i=e.require=function(t){if(!o.hasOwnProperty(t))throw new Error("Module "+t+" has not been defined");var n=o[t];if(!n.resolved){var a=[];n.deps.forEach(function(t){a.push(i(t))}),n.exports=n.factory.apply(e,a)||null,n.resolved=!0}return n.exports}}if(!n)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(function(t,e){t("skylark-easyeditor/EasyEditor",["skylark-langx/skylark","skylark-langx/langx","skylark-utils-dom/browser","skylark-utils-dom/noder","skylark-utils-dom/eventer","skylark-utils-dom/finder","skylark-utils-dom/query","skylark-utils-dom/plugins"],function(t,e,n,i,a,r,o,l){"use strict";var s=l.Plugin.inherit({klassName:"EasyEditor",_construct:function(t,e){this.elem=t,e=e||{},this.className=e.className||"easyeditor";this.buttons=e.buttons||["bold","italic","link","h2","h3","h4","alignleft","aligncenter","alignright"],this.buttonsHtml=e.buttonsHtml||null,this.overwriteButtonSettings=e.overwriteButtonSettings||null,this.css=e.css||null,this.onLoaded="function"==typeof e.onLoaded?e.onLoaded:null,this.randomString="cls"+Math.random().toString(36).substring(7),this.theme=e.theme||null,this.dropdown=e.dropdown||{},this.characterLimit=e.characterLimit||null,this.characterLimitText=e.characterLimitText||null,this.characterLimitPreventKeypress=e.characterLimitPreventKeypress||!1,this.attachEvents()},attachEvents:function(){this.bootstrap(),this.addToolbar(),this.handleKeypress(),this.handleResizeImage(),this.utils(),null!==this.onLoaded&&this.onLoaded.call(this,this),this.characterLimit&&this.enableCharacterLimit()},detachEvents:function(){var t=o(this.elem).closest("."+this.className+"-wrapper"),e=t.find("."+this.className+"-toolbar");e.remove(),o(this.elem).removeClass(this.className).removeAttr("contenteditable").unwrap()},bootstrap:function(){var t=o(this.elem).prop("tagName").toLowerCase();if("textarea"===t||"input"===t){var e=o(this.elem).attr("placeholder")||"",n=o(this.elem).css("marginTop")||0,i=o(this.elem).css("marginBottom")||0,a="";(n.length>0||i.length>0)&&(a=' style="margin-top: '+n+"; margin-bottom: "+i+'" '),o(this.elem).after('<div id="'+this.randomString+'-editor" placeholder="'+e+'">'+o(this.elem).val()+"</div>"),o(this.elem).hide().addClass(this.randomString+"-bind"),this.elem=document.getElementById(this.randomString+"-editor"),o(this.elem).attr("contentEditable",!0).addClass(this.className).wrap('<div class="'+this.className+'-wrapper"'+a+"></div>")}else o(this.elem).attr("contentEditable",!0).addClass(this.className).wrap('<div class="'+this.className+'-wrapper"></div>');this.$wrapperElem=o(this.elem).parent(),null!==this.css&&o(this.elem).css(this.css),this.containerClass="."+this.className+"-wrapper","string"==typeof this.elem&&(this.elem=o(this.elem).get(0)),null!==this.theme&&o(this.elem).closest(this.containerClass).addClass(this.theme)},handleKeypress:function(){var t=this;o(t.elem).keydown(function(e){if(13===e.keyCode&&!1===t.isSelectionInsideElement("li"))return e.preventDefault(),!0===e.shiftKey?document.execCommand("insertHTML",!1,"<br>"):document.execCommand("insertHTML",!1,"<br><br>"),!1}),t.elem.addEventListener("paste",function(t){t.preventDefault();var e=t.clipboardData.getData("text/plain").replace(/\n/gi,"<br>");document.execCommand("insertHTML",!1,e)})},isSelectionInsideElement:function(t){var e,n;for(t=t.toUpperCase(),window.getSelection?(e=window.getSelection()).rangeCount>0&&(n=e.getRangeAt(0).commonAncestorContainer):(e=document.selection)&&"Control"!=e.type&&(n=e.createRange().parentElement());n;){if(1==n.nodeType&&n.tagName==t)return!0;n=n.parentNode}return!1},addToolbar:function(){o(this.elem).before('<div class="'+this.className+'-toolbar"><ul></ul></div>'),this.$toolbarContainer=this.$wrapperElem.find("."+this.className+"-toolbar"),this.populateButtons()},injectButton:function(t){var n,i=this;if(null!==i.overwriteButtonSettings&&void 0!==i.overwriteButtonSettings[t.buttonIdentifier]){var a=e.extend({},t,i.overwriteButtonSettings[t.buttonIdentifier]);t=a}if(null!==i.buttonsHtml&&void 0!==i.buttonsHtml[t.buttonIdentifier]&&(t.buttonHtml=i.buttonsHtml[t.buttonIdentifier]),n=t.buttonTitle?t.buttonTitle:t.buttonIdentifier.replace(/\W/g," "),t.buttonHtml)if(void 0!==t.childOf){var r=i.$toolbarContainer.find(".toolbar-"+t.childOf).parent("li");0===r.find("ul").length&&r.append("<ul></ul>"),(r=r.find("ul")).append('<li><button type="button" class="toolbar-'+t.buttonIdentifier+'" title="'+n+'">'+t.buttonHtml+"</button></li>")}else i.$toolbarContainer.children("ul").append('<li><button type="button" class="toolbar-'+t.buttonIdentifier+'" title="'+n+'">'+t.buttonHtml+"</button></li>");"function"==typeof t.clickHandler&&o(i.elem).closest(i.containerClass).on("click",".toolbar-"+t.buttonIdentifier,function(e){void 0!==typeof t.hasChild&&!0===t.hasChild?e.stopPropagation():e.preventDefault(),t.clickHandler.call(this,this),o(i.elem).trigger("keyup")})},openDropdownOf:function(t){o(this.elem).closest(this.containerClass).find(".toolbar-"+t).parent().children("ul").show()},populateButtons:function(){var t=this;e.each(t.buttons,function(e,n){"function"==typeof t[n]&&t[n]()})},handleResizeImage:function(){var t=this;o("html").on("click",t.containerClass+" figure",function(t){t.stopPropagation(),o(this).addClass("is-resizable")}),o("html").on("mousemove",t.containerClass+" figure.is-resizable",function(t){o(this).find("img").css({width:o(this).width()+"px"})}),o(document).click(function(){o(t.elem).find("figure").removeClass("is-resizable")})},getSelection:function(){if(window.getSelection){var t=window.getSelection();if(t.rangeCount)return t}return!1},removeFormatting:function(t){var n=t.inFullArea;if(!0===this.isSelectionOutsideOfEditor())return!1;if(!1===n){var i=this.getSelection(),a=i.toString();if(i&&a.length>0){var r=i.getRangeAt(0),l=o(r.commonAncestorContainer.parentNode);if(l.attr("class")===this.className||l.attr("class")===this.className+"-wrapper"){var s=document.createElement("span");o(s).attr("data-value","temp").html(a.replace(/\n/gi,"<br>")),r.deleteContents(),r.insertNode(s),o('[data-value="temp"]').contents().unwrap()}else{var c,u=!1;e.each(l.parentsUntil(this.elem),function(t,e){c=e,u=!0}),!0===u?o(c).html(o(c).text().replace(/\n/gi,"<br>")).contents().unwrap():l.contents().unwrap()}}}else o(this.elem).html(o(this.elem).text().replace(/\n/gi,"<br>"))},removeEmptyTags:function(){o(this.elem).html(o(this.elem).html().replace(/(<(?!\/)[^>]+>)+(<\/[^>]+>)+/,""))},removeBlockElementFromSelection:function(t,e){var n="";!0===(e=void 0!==e&&e)&&(n=", br");var i=t.getRangeAt(0),a=i.cloneContents(),r=document.createElement("temp");return o(r).html(a),o(r).find("h1, h2, h3, h4, h5, h6, p, div"+n).each(function(){o(this).replaceWith(this.childNodes)}),o(r).html()},wrapSelectionWithNodeName:function(t){if(!0===this.isSelectionOutsideOfEditor())return!1;var e={name:"span",blockElement:!1,style:null,class:null,attribute:null,keepHtml:!1};"string"==typeof t?e.name=t:(e.name=t.nodeName||e.name,e.blockElement=t.blockElement||e.blockElement,e.style=t.style||e.style,e.class=t.class||e.class,e.attribute=t.attribute||e.attribute,e.keepHtml=t.keepHtml||e.keepHtml);var n=this.getSelection();if(n&&n.toString().length>0&&n.rangeCount){var i=this.isAlreadyWrapped(n,e),a=n.getRangeAt(0).cloneRange(),r=document.createElement(e.name);if(null===e.style&&null===e.class&&null===e.attribute||(r=this.addAttribute(r,e)),this.selectionContainsHtml(a)){if(a=n.getRangeAt(0),!0===e.keepHtml){var l=a.cloneContents(),s=document.createElement("div");s.appendChild(l),o(r).html(s.innerHTML)}else r.textContent=n.toString();a.deleteContents(),a.insertNode(r),a.commonAncestorContainer.localName===e.name&&(o(a.commonAncestorContainer).contents().unwrap(),this.removeEmptyTags())}else a.surroundContents(r),n.removeAllRanges(),n.addRange(a);!0===i&&this.removeWrappedDuplicateTag(r),this.removeEmptyTags(),n.removeAllRanges()}},wrapSelectionWithList:function(t){if(t=t||"ul",!0===this.isSelectionOutsideOfEditor())return!1;var n=this.getSelection();if(n&&n.toString().length>0&&n.rangeCount){var i=this.removeBlockElementFromSelection(n,!0),a=i.split("\n").filter(function(t){return""!==t}),r=e.map(a,function(t){return"<li>"+e.trim(t)+"</li>"}),l=document.createElement(t);o(l).html(r);var s=n.getRangeAt(0);s.deleteContents(),s.insertNode(l),n.removeAllRanges()}},selectionContainsHtml:function(t){return t.startContainer.parentNode.className!==this.className+"-wrapper"},isAlreadyWrapped:function(t,n){var i=t.getRangeAt(0),a=o(i.commonAncestorContainer),r=!1;return a.parent().prop("tagName").toLowerCase()===n.name&&!1===a.parent().hasClass(this.className)?r=!0:!0===n.blockElement?e.each(a.parentsUntil(this.elem),function(t,n){var i=n.tagName.toLowerCase();-1!==e.inArray(i,["h1","h2","h3","h4","h5","h6"])&&(r=!0)}):e.each(a.parentsUntil(this.elem),function(t,e){var i=e.tagName.toLowerCase();i===n.name&&(r=!0)}),r},removeWrappedDuplicateTag:function(t){var e=t.tagName;o(t).unwrap(),o(t).prop("tagName")===e&&!1===o(t).parent().hasClass(this.className)&&o(t).parent().hasClass(this.className+"-wrapper")&&o(t).unwrap()},addAttribute:function(t,n){return null!==n.style&&o(t).attr("style",n.style),null!==n.class&&o(t).addClass(n.class),null!==n.attribute&&(!0===e.isArray(n.attribute)?(!0!==e.isArray(n.attribute[0])&&(n.attribute[0]=[n.attribute[0],n.attribute[1]]),e.each(n.attribute,function(e,n){o(t).attr(n[0],n[1])})):o(t).attr(n.attribute)),t},insertAtCaret:function(t){if(!0===this.isSelectionOutsideOfEditor())return!1;if(this.getSelection()){var e=this.getSelection().getRangeAt(0);e.insertNode(t)}else o(t).appendTo(this.elem)},isSelectionOutsideOfEditor:function(){return!this.elementContainsSelection(this.elem)},isOrContains:function(t,e){for(;t;){if(t===e)return!0;t=t.parentNode}return!1},elementContainsSelection:function(t){var e;if(window.getSelection){if((e=window.getSelection()).rangeCount>0){for(var n=0;n<e.rangeCount;++n)if(!this.isOrContains(e.getRangeAt(n).commonAncestorContainer,t))return!1;return!0}}else if((e=document.selection)&&"Control"!==e.type)return this.isOrContains(e.createRange().parentElement(),t);return!1},insertHtml:function(t){o(this.elem).find("temp").html(t)},utils:function(){var t,e=this;(o("html").on("click","."+e.className+"-modal-close",function(t){t.preventDefault(),e.closeModal("#"+o(this).closest("."+e.className+"-modal").attr("id"))}),o("."+e.randomString+"-bind").length>0)&&o("html").on("click keyup",e.elem,function(){var n=e.elem;clearTimeout(t),t=setTimeout(function(){o("."+e.randomString+"-bind").html(o(n).html())},250)});o(document).click(function(t){o("."+e.className).closest("."+e.className+"-wrapper").find("."+e.className+"-toolbar > ul > li > ul").hide()})},getValue:function(){var t=o(this.elem).html(),e=o(this.elem).text(),n=e.length,i=e.trim().split(/\s+/).length;return{html:t,plainText:e,characterCount:n,wordCount:i}},enableCharacterLimit:function(){var t=this,e=t.characterLimit-t.getValue().characterCount;o(t.elem).after('<div class="'+t.className+"-character-remaining "+(e<=0?"is-invalid":"is-valid")+'">'+(t.characterLimitText?t.characterLimitText+" "+e:e)+"</div>"),o("html").on("keyup",t.elem,function(){var e=t.getValue(),n=t.characterLimit-e.characterCount,i=o(t.containerClass).find('[class*="-character-remaining"]');t.characterLimitText?i.text(t.characterLimitText+" "+n):i.text(n),n<=0?i.removeClass("is-valid").addClass("is-invalid"):i.removeClass("is-invalid").addClass("is-valid")}),o("html").on("keypress",t.elem,function(){var e=t.getValue();if(t.characterLimitPreventKeypress&&t.characterLimit<=e.characterCount)return!1})},getYoutubeVideoIdFromUrl:function(t){if(0===t.length)return!1;return t=t.replace(/(>|<)/gi,"").split(/(vi\/|v=|\/v\/|youtu\.be\/|\/embed\/)/),void 0!==t[2]?t[2].split(/[^0-9a-z_\-]/i)[0]:t},openModal:function(t){var e=document.createElement("temp");e.textContent=".",this.insertAtCaret(e),o(t).removeClass("is-hidden")},closeModal:function(t){o(t).addClass("is-hidden").find("input").val(""),o(t).find("."+this.className+"-modal-content-body-loader").css("width","0");var e=o(this.elem).find("temp");"."===e.html()?e.remove():e.contents().unwrap(),o(this.elem).focus()},bold:function(){var t=this,e={buttonIdentifier:"bold",buttonHtml:"B",clickHandler:function(){t.wrapSelectionWithNodeName({nodeName:"strong",keepHtml:!0})}};t.injectButton(e)},italic:function(){var t=this,e={buttonIdentifier:"italic",buttonHtml:"I",clickHandler:function(){t.wrapSelectionWithNodeName({nodeName:"em",keepHtml:!0})}};t.injectButton(e)},h2:function(){var t=this,e={buttonIdentifier:"header-2",buttonHtml:"H2",clickHandler:function(){t.wrapSelectionWithNodeName({nodeName:"h2",blockElement:!0})}};t.injectButton(e)},h3:function(){var t=this,e={buttonIdentifier:"header-3",buttonHtml:"H3",clickHandler:function(){t.wrapSelectionWithNodeName({nodeName:"h3",blockElement:!0})}};t.injectButton(e)},h4:function(){var t=this,e={buttonIdentifier:"header-4",buttonHtml:"H4",clickHandler:function(){t.wrapSelectionWithNodeName({nodeName:"h4",blockElement:!0})}};t.injectButton(e)},x:function(){var t=this,e={buttonIdentifier:"remove-formatting",buttonHtml:"x",clickHandler:function(){t.removeFormatting({inFullArea:!1})}};t.injectButton(e)},alignleft:function(){var t=this,e={buttonIdentifier:"align-left",buttonHtml:"Align left",clickHandler:function(){t.wrapSelectionWithNodeName({nodeName:"p",style:"text-align: left",class:"text-left",keepHtml:!0})}};t.injectButton(e)},aligncenter:function(){var t=this,e={buttonIdentifier:"align-center",buttonHtml:"Align center",clickHandler:function(){t.wrapSelectionWithNodeName({nodeName:"p",style:"text-align: center",class:"text-center",keepHtml:!0})}};t.injectButton(e)},alignright:function(){var t=this,e={buttonIdentifier:"align-right",buttonHtml:"Align right",clickHandler:function(){t.wrapSelectionWithNodeName({nodeName:"p",style:"text-align: right",class:"text-right",keepHtml:!0})}};t.injectButton(e)},quote:function(){var t=this,e={buttonIdentifier:"quote",buttonHtml:"Quote",clickHandler:function(){t.wrapSelectionWithNodeName({nodeName:"blockquote"})}};t.injectButton(e)},code:function(){var t=this,e={buttonIdentifier:"code",buttonHtml:"Code",clickHandler:function(){t.wrapSelectionWithNodeName({nodeName:"pre"})}};t.injectButton(e)},link:function(){var t=this,e={buttonIdentifier:"link",buttonHtml:"Link",clickHandler:function(){t.wrapSelectionWithNodeName({nodeName:"a",attribute:["href",prompt("Insert link","")]})}};t.injectButton(e)},list:function(){var t=this,e={buttonIdentifier:"list",buttonHtml:"List",clickHandler:function(){t.wrapSelectionWithList()}};t.injectButton(e)},source:function(){var t=this,e={buttonIdentifier:"source",buttonHtml:"Source",clickHandler:function(e){var n,i=o(e).closest("."+t.className+"-wrapper"),a=i.find("."+t.className);o(e).hasClass("is-view-source-mode")?(n=o("body > textarea."+t.className+"-temp"),a.css("visibility","visible"),n.remove(),o(e).removeClass("is-view-source-mode")):(o("body").append('<textarea class="'+t.className+'-temp" style="position: absolute; margin: 0;"></textarea>'),(n=o("body > textarea."+t.className+"-temp")).css({top:a.offset().top,left:a.offset().left,width:a.outerWidth(),height:a.outerHeight()}).html(a.html()),void 0!==a.css("border")&&n.css("border",a.css("border")),a.css("visibility","hidden"),o(e).addClass("is-view-source-mode"),n.on("keyup click change keypress",function(){a.html(o(this).val())}))}};t.injectButton(e)}});return o.fn.easyEditor=function(t){return this.each(function(){o.data(this,"plugin_easyEditor")||o.data(this,"plugin_easyEditor",new s(this,t))})},s}),t("skylark-easyeditor/main",["./EasyEditor"],function(t){return t}),t("skylark-easyeditor",["skylark-easyeditor/main"],function(t){return t})}(n),!a){var l=i("skylark-langx/skylark");r?module.exports=l:e.skylarkjs=l}}(0,this);
//# sourceMappingURL=sourcemaps/skylark-easyeditor.js.map
